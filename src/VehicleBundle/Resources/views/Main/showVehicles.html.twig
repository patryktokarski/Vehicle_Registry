{% extends 'base.html.twig' %}

{% block title %}
    {% if cars is empty %}
        No results found
    {% else %}
        {{ cars|length}} results found. These vehicles match the search criteria.
    {% endif %}
{% endblock %}

{% block desc %}

    {% set totalResultCons = 0 %}
    {% for one in carsTotalAvg %}
        {% set totalResultCons = totalResultCons + one %}
    {% endfor %}

    <ul>
        {% for br in brand %}<li>Brand: {{ br.name }}</li>{% endfor %}
        {% if model != null %}{% for ml in model %}<li>Model: {{ ml.name }}</li>{% endfor %}{% endif %}
    </ul>
        {% if cars is not empty %}
        Additional information:
        {% endif %}
    <ul>
        {% if cars is not empty %}<li>Average fuel consumption for found results:
            {% if (carsTotalAvg|length) != 0 %}{{ (totalResultCons/(carsTotalAvg|length))|number_format(1, '.')}}
            {% else %}
                0
            {% endif %}</li>
        {% endif %}

        {% if topCategories is not empty %}
        <li>The most common problems:
            <ul>
            {% for topCategory in topCategories %}
            <li>{{ topCategory[0].name }}  {{ percentage[loop.index - 1]|number_format(1, ".") }}%*</li>
        {% endfor %}
                </ul>
        </li>
            <small><small>* per all reported repairs: {{ allRepairs }}</small></small>.
        {% endif %}
    </ul>
{% endblock desc %}
{% block body %}
    <table class="table">
        <thead>
            <tr>
                <th>Brand</th>
                <th>Model</th>
                <th>Fuel</th>
                <th>Capacity</th>
                <th>Power</th>
                <th>User</th>
                <th>Average Fuel Consumption [l/100km]</th>
            </tr>
        </thead>
        <tbody>
        {% for car in cars %}
            <tr>
                <td><a href="{{ path('show_vehicle_info', { 'id': car.id }) }}">{{ car.brand.name }}</a></td>
                <td>{{ car.model.name }}</td>
                <td>{{ car.fuel }}</td>
                <td>{{ car.capacity }}</td>
                <td>{{ car.power }}</td>
                <td>{{ car.user.username }}</td>
                <td>{{ (carsTotalAvg[loop.index-1])|number_format(1, '.') }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
        
{% endblock body %}       

